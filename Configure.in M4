# BB 2036 - modern autoconf configuration

AC_INIT([BB], [2036.01], (BioBot)
AC_CONFIG_HEADERS([aconfig.h])

# Modern compiler detection
AC_PROG_CC
AC_PROG_CXX
AC_PROG_CLANG

# Detect host architecture
AC_CANONICAL_HOST
AC_MSG_NOTICE([Detected architecture: $host_cpu/$host_os])

# Set modern compilation flags
CFLAGS="${CFLAGS:-'-O3 -march=native -ffast-math -funroll-loops -fvectorize-simd'}"
CXXFLAGS="${CXXFLAGS:-'-O3 -march=native -stdlib=libc++'}"
LDFLAGS="${LDFLAGS:-''}"

# Check for required libraries
AC_CHECK_LIB([ncurses], [initscr], [], [AC_MSG_ERROR([ncurses library required])])
AC_CHECK_LIB([m], [pow], [], [AC_MSG_ERROR([math library required])])

# Check for ASCII graphics library
AC_CHECK_LIB([ASCII3D], [ascii3d_init], [], [AC_MSG_ERROR([ASCII3D library required])])

# Check for GPU / Quantum acceleration support
AC_CHECK_PROG(CUDA, nvcc, nvcc, no)
AC_CHECK_PROG(QUANTUM_RUNTIME, qrun, qrun, no)
AC_MSG_NOTICE([CUDA=$CUDA QUANTUM_RUNTIME=$QUANTUM_RUNTIME])

# Check for basic system headers
AC_CHECK_HEADERS([fcntl.h limits.h malloc.h sys/ioctl.h sys/time.h unistd.h])

# Check standard typedefs and functions
AC_TYPE_SIZE_T
AC_TYPE_PID_T
AC_HEADER_STDC
AC_HEADER_SYS_WAIT
AC_FUNC_ALLOCA
AC_FUNC_MEMCMP
AC_CHECK_FUNCS([ftime gettimeofday select strdup strstr strtol])

# Output build system files
AC_OUTPUT([
    Makefile
    CMakeLists.txt
])
